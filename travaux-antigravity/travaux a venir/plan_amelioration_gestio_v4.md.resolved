# ğŸš€ Plan d'AmÃ©lioration Gestio V4

## ğŸ“‹ Vue d'ensemble

Ce plan dÃ©taille les 3 phases d'amÃ©lioration de Gestio V4 :
1. **Phase 1 : Debugging & Optimisation** (PrioritÃ© haute)
2. **Phase 2 : Refactoring & Consolidation** (PrioritÃ© moyenne)
3. **Phase 3 : Nouvelles FonctionnalitÃ©s** (PrioritÃ© basse)

---

## ğŸ¯ Objectifs Globaux

- âœ… Corriger tous les bugs existants
- âœ… Optimiser les performances (temps de chargement, requÃªtes SQL)
- âœ… AmÃ©liorer la structure du code (maintenabilitÃ©)
- âœ… Ajouter des visualisations avancÃ©es (Heatmap, analyses)

---

# ğŸ“Š Phase 1 : Debugging & Optimisation

**DurÃ©e estimÃ©e** : 3-5 jours  
**Objectif** : Application stable et performante

## 1.1 Debugging

### ğŸ› Bugs Ã  corriger
- [ ] Tester toutes les fonctionnalitÃ©s (ajout, modification, suppression)
- [ ] VÃ©rifier les calculs (solde, totaux, statistiques)
- [ ] Tester les filtres (calendrier, catÃ©gories)
- [ ] VÃ©rifier l'export CSV
- [ ] Tester le mode Ã©dition

### ğŸ” Tests Ã  effectuer
- [ ] Ajouter 50+ transactions de test
- [ ] Tester avec diffÃ©rents mois/annÃ©es
- [ ] Tester les cas limites (montants nÃ©gatifs, dates futures, etc.)
- [ ] VÃ©rifier la cohÃ©rence des donnÃ©es

---

## 1.2 Optimisation des Performances

### âš¡ RequÃªtes SQL
- [ ] Ajouter des index sur colonnes frÃ©quemment utilisÃ©es
  ```sql
  CREATE INDEX idx_date ON mes_transactions(date);
  CREATE INDEX idx_categorie ON mes_transactions(categorie);
  CREATE INDEX idx_type ON mes_transactions(type);
  ```
- [ ] Optimiser les requÃªtes avec `EXPLAIN QUERY PLAN`
- [ ] Ã‰viter les requÃªtes multiples (utiliser JOIN si possible)

### ğŸ¨ Streamlit
- [ ] Utiliser `@st.cache_data` pour les requÃªtes SQL
- [ ] Utiliser `@st.cache_resource` pour la connexion DB
- [ ] Limiter les `st.rerun()` inutiles
- [ ] Optimiser les graphiques Plotly (rÃ©duire les donnÃ©es si > 1000 points)

### ğŸ“Š Pandas
- [ ] VÃ©rifier qu'il n'y a pas de boucles `for` (utiliser vectorisation)
- [ ] Utiliser `groupby()` au lieu de boucles
- [ ] Optimiser les `pivot_table()` et [merge()](file:///c:/Users/djabi/Desktop/apprentissage/exercices/exercice%20pandas.py#238-241)

---

# ğŸ”§ Phase 2 : Refactoring & Consolidation

**DurÃ©e estimÃ©e** : 5-7 jours  
**Objectif** : Code propre, maintenable et modulaire

## 2.1 Restructuration du Code

### ğŸ“ Organisation des fichiers
```
gestio_v4/
â”œâ”€â”€ main.py                    # Point d'entrÃ©e
â”œâ”€â”€ config.py                  # Configuration globale
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ connection.py          # Gestion connexion DB
â”‚   â””â”€â”€ queries.py             # RequÃªtes SQL centralisÃ©es
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ tableau_bord.py
â”‚   â”œâ”€â”€ voir_transactions.py
â”‚   â”œâ”€â”€ ajouter_transaction.py
â”‚   â””â”€â”€ parametres.py
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ graphs.py              # Fonctions graphiques Plotly
â”‚   â”œâ”€â”€ filters.py             # Composants de filtrage
â”‚   â””â”€â”€ stats.py               # Calculs statistiques
â””â”€â”€ utils/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ helpers.py             # Fonctions utilitaires
    â””â”€â”€ validators.py          # Validation des donnÃ©es
```

### ğŸ”„ Refactoring du Code

#### CrÃ©er des fonctions rÃ©utilisables
- [ ] Extraire la logique de connexion DB dans `database/connection.py`
- [ ] Centraliser les requÃªtes SQL dans `database/queries.py`
- [ ] CrÃ©er des fonctions pour chaque graphique dans `components/graphs.py`
- [ ] CrÃ©er des fonctions de validation dans `utils/validators.py`

#### Exemple de refactoring
**Avant** :
```python
# Code dupliquÃ© dans chaque page
conn = sqlite3.connect('transaction.db')
df = pd.read_sql_query("SELECT * FROM mes_transactions", conn)
conn.close()
```

**AprÃ¨s** :
```python
# database/queries.py
@st.cache_data
def get_all_transactions():
    with get_connection() as conn:
        return pd.read_sql_query("SELECT * FROM mes_transactions", conn)

# Dans les pages
df = get_all_transactions()
```

---

## 2.2 AmÃ©lioration de la Structure

### ğŸ“ Typing (Annotations de types)
- [ ] Ajouter des annotations de types Ã  toutes les fonctions
  ```python
  def calculer_solde(df: pd.DataFrame) -> float:
      revenus = df[df['type'] == 'revenu']['montant'].sum()
      depenses = df[df['type'] == 'depense']['montant'].sum()
      return revenus - depenses
  ```

### ğŸ§ª Tests Unitaires (Optionnel)
- [ ] CrÃ©er des tests pour les fonctions critiques
- [ ] Tester les calculs (solde, statistiques)
- [ ] Tester les validations

---

# ğŸ¨ Phase 3 : Nouvelles FonctionnalitÃ©s

**DurÃ©e estimÃ©e** : 7-10 jours  
**Objectif** : Enrichir l'application avec des analyses avancÃ©es

## 3.1 RÃ©organisation "Voir Transactions"

### ğŸ“Š Nouvelle structure avec sous-onglets

```
ğŸ“Š Voir Transactions
â”œâ”€â”€ ğŸ“‹ Vue Standard
â”‚   â”œâ”€â”€ Graphique Ã©volution (actuel)
â”‚   â””â”€â”€ Tableau transactions (actuel)
â”‚
â””â”€â”€ ğŸ“Š Analyses AvancÃ©es
    â”œâ”€â”€ ğŸ”¥ Heatmap Mensuelle
    â””â”€â”€ ğŸŒ³ Arbre HiÃ©rarchique (Sunburst)
```

### ImplÃ©mentation
- [ ] CrÃ©er les sous-onglets avec `st.tabs()`
- [ ] DÃ©placer le Sunburst depuis `arbre_dynamique.py`
- [ ] CrÃ©er la Heatmap mensuelle

---

## 3.2 Heatmap Mensuelle

### ğŸ“Š FonctionnalitÃ©
- Matrice : Jours (lignes) Ã— CatÃ©gories (colonnes)
- Couleurs : Vert (faible) â†’ Rouge (Ã©levÃ©)
- Valeurs : Montant affichÃ© dans chaque cellule

### Code
```python
# CrÃ©er la matrice
pivot = df_mois.pivot_table(
    values='montant',
    index='jour',
    columns='categorie',
    aggfunc='sum',
    fill_value=0
)

# Heatmap
fig = go.Figure(data=go.Heatmap(
    z=pivot.values,
    x=pivot.columns,
    y=pivot.index,
    colorscale='RdYlGn_r',
    text=pivot.values,
    texttemplate='%{text:.0f}â‚¬'
))
```

### TÃ¢ches
- [ ] CrÃ©er la fonction `create_heatmap()` dans `components/graphs.py`
- [ ] Ajouter un sÃ©lecteur de mois
- [ ] Ajouter une lÃ©gende explicative
- [ ] Optimiser pour les mois avec peu de transactions

---

## 3.3 Module Portefeuille (Gestion Multi-Comptes)

### ğŸ’¼ Compte Bancaire
- [ ] CrÃ©er table `comptes` (nom, type, solde_initial, devise)
- [ ] Lier transactions aux comptes
- [ ] Dashboard multi-comptes (solde par compte)
- [ ] Transferts entre comptes

### ğŸ“Š Investissements (Actions/ETF)
- [ ] CrÃ©er table `investissements` (ticker, quantitÃ©, date_achat, prix_achat)
- [ ] IntÃ©gration API Yahoo Finance (`yfinance`)
- [ ] Calcul automatique gains/pertes
- [ ] Graphique Candlestick pour Ã©volution
- [ ] Dashboard portefeuille (rÃ©partition, performance)

### ğŸ¯ Budget avec Gauge
- [ ] Ajouter graphique Gauge dans "Portefeuille/Budget"
- [ ] Indicateur visuel : Vert (0-70%), Orange (70-90%), Rouge (90-100%)
- [ ] Alertes si dÃ©passement > 10%

---

## 3.4 Graphiques AvancÃ©s

### ğŸ“ˆ Waterfall
- [ ] Ã‰volution du solde (Solde initial â†’ Revenus â†’ DÃ©penses â†’ Solde final)
- [ ] IntÃ©grer dans "Tableau de Bord" ou "Analyses AvancÃ©es"

### ğŸ“‰ Funnel
- [ ] Entonnoir de conversion budget (Transactions totales â†’ ValidÃ©es â†’ CatÃ©gorisÃ©es â†’ BudgÃ©tÃ©es â†’ ExportÃ©es)
- [ ] Utile pour analyser le processus de gestion

---

## 3.5 Refactoring Portefeuille

### ğŸ”„ StratÃ©gie Multipage
- [ ] CrÃ©er `pages/portefeuille/` avec sous-pages :
  - `comptes.py` (gestion comptes bancaires)
  - `investissements.py` (suivi actions/ETF)
  - `budget.py` (budget avec Gauge)
- [ ] Centraliser la logique dans `components/portfolio.py`

---

## 3.6 Autres AmÃ©liorations (Optionnel)

### ğŸ¯ FonctionnalitÃ©s AvancÃ©es
- [ ] Comparaison Budget vs RÃ©el avec alertes
- [ ] PrÃ©visions (tendances futures)
- [ ] Export PDF des rapports
- [ ] Mode sombre/clair

---

## ğŸ“… Planning Global

| Phase | DurÃ©e | PrioritÃ© | Statut |
|-------|-------|----------|--------|
| Phase 1 : Debugging & Optimisation | 3-5 jours | ğŸ”´ Haute | â³ Ã€ faire |
| Phase 2 : Refactoring | 5-7 jours | ğŸŸ¡ Moyenne | â³ Ã€ faire |
| Phase 3 : Nouvelles FonctionnalitÃ©s | 7-10 jours | ğŸŸ¢ Basse | â³ Ã€ faire |

**DurÃ©e totale estimÃ©e** : 15-22 jours

---

## ğŸ¯ Prochaines Ã‰tapes

1. âœ… Terminer exercice 25 Plotly
2. â³ Phase 1 : Debugging (tester toutes les fonctionnalitÃ©s)
3. â³ Phase 1 : Optimisation (cache, index SQL)
4. â³ Phase 2 : Refactoring (structure, typing)
5. â³ Phase 3 : Heatmap + Sunburst dans "Voir Transactions"
